<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Distributed Database - Node View</title>

    <!-- CSS File -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <!-- Single Unified View -->
    <div id="main-view" class="container">
        <h1>Distributed Database - <span id="current-node-title">Loading...</span></h1>

        <!-- Node Status Bar (Non-clickable) -->
        <div class="status-bar">
            <div class="status-item">
                <div class="status-item-header">
                    <span class="status-item-title">Node 1 (Central)</span>
                    <span class="status-indicator status-online" id="node1-status">LOADING...</span>
                </div>
                <div class="status-item-info">
                    <span class="status-detail">Rows: <strong id="node1-rows">--</strong></span>
                    <span class="status-detail">Updated: <span id="node1-update">--</span></span>
                </div>
            </div>

            <div class="status-item">
                <div class="status-item-header">
                    <span class="status-item-title">Node 2 (Regional)</span>
                    <span class="status-indicator status-online" id="node2-status">LOADING...</span>
                </div>
                <div class="status-item-info">
                    <span class="status-detail">Rows: <strong id="node2-rows">--</strong></span>
                    <span class="status-detail">Updated: <span id="node2-update">--</span></span>
                </div>
            </div>

            <div class="status-item">
                <div class="status-item-header">
                    <span class="status-item-title">Node 3 (Regional)</span>
                    <span class="status-indicator status-online" id="node3-status">LOADING...</span>
                </div>
                <div class="status-item-info">
                    <span class="status-detail">Rows: <strong id="node3-rows">--</strong></span>
                    <span class="status-detail">Updated: <span id="node3-update">--</span></span>
                </div>
            </div>
        </div>

        <!-- Settings Section -->
        <div class="settings-section">
            <div class="form-group">
                <label for="isolation-level">Isolation Level</label>
                <select id="isolation-level">
                    <option value="read-uncommitted">Read Uncommitted</option>
                    <option value="read-committed" selected>Read Committed</option>
                    <option value="repeatable-read">Repeatable Read</option>
                    <option value="serializable">Serializable</option>
                </select>
            </div>

            <div class="form-group">
                <label for="autocommit-toggle">Transaction Mode</label>
                <div class="toggle-container">
                    <span class="toggle-label">Manual 2PC</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="autocommit-toggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                    <span class="toggle-label">Auto Commit</span>
                </div>
                <small style="color: #666; margin-top: 5px;">Toggle between Manual Two-Phase Commit and Automatic Commit modes</small>
            </div>

            <button onclick="applySettings()">Apply Settings</button>
        </div>

        <!-- Row Count Display -->
        <div class="row-count-display">
            Showing <span id="current-rows">0</span> of <span id="total-rows">0</span> rows
        </div>

        <!-- Filter Section -->
        <div class="filter-section">
            <div class="form-group">
                <label for="filter-titleid">Title ID</label>
                <input type="text" id="filter-titleid" placeholder="Filter by Title ID">
            </div>
            <div class="form-group">
                <label for="filter-title">Title</label>
                <input type="text" id="filter-title" placeholder="Filter by Title">
            </div>
            <div class="form-group">
                <label for="filter-region">Region</label>
                <input type="text" id="filter-region" placeholder="Filter by Region">
            </div>
            <button onclick="applyFilters()">Apply Filters</button>
            <button class="secondary-button" onclick="clearFilters()">Clear</button>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="insert-button" onclick="openInsertModal()">+ Insert</button>
            <button class="concurrency-button" onclick="simulateConcurrency()">âš¡ Simulate Concurrency</button>
            <button class="report-button" onclick="generateReport(1)">ðŸ“„ Report 1: Region</button>
            <button class="report-button" onclick="generateReport(2)">ðŸ“„ Report 2: Type</button>
        </div>

        <table class="data-table" id="data-table">
            <thead>
                <tr>
                    <th style="width: 10%;">Title ID</th>
                    <th style="width: 5%;">Order</th>
                    <th style="width: 20%;">Title</th>
                    <th style="width: 8%;">Region</th>
                    <th style="width: 8%;">Language</th>
                    <th style="width: 12%;">Types</th>
                    <th style="width: 15%;">Attributes</th>
                    <th style="width: 7%;">Original</th>
                    <th style="width: 15%;">Actions</th>
                </tr>
            </thead>
            <tbody id="table-body">
                <!-- Data will be loaded dynamically -->
            </tbody>
        </table>

        <!-- Load More Button -->
        <div class="load-more-section">
            <button id="load-more-btn" onclick="loadMoreRows()">Load More Rows</button>
        </div>
    </div>

    <!-- Insert Modal -->
    <div id="insert-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Insert New Record</h2>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="insert-titleid">Title ID *</label>
                    <input type="text" id="insert-titleid" placeholder="e.g., tt1234567" required>
                    <small style="color: #666;">Enter a unique title ID (e.g., tt followed by numbers)</small>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="ordering">Ordering *</label>
                        <input type="number" id="ordering" placeholder="Enter ordering number" required>
                    </div>
                    <div class="form-group">
                        <label for="title-region">Region *</label>
                        <select id="title-region" required>
                            <option value="">Select Region</option>
                            <option value="US">US</option>
                            <option value="JP">JP</option>
                            <option value="ES">ES</option>
                            <option value="FR">FR</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="title-name">Title *</label>
                    <textarea id="title-name" placeholder="Enter title name" required></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="language">Language *</label>
                        <input type="text" id="language" placeholder="e.g., en, ja, es" maxlength="10" required>
                    </div>
                    <div class="form-group">
                        <label for="types">Types *</label>
                        <input type="text" id="types" placeholder="e.g., movie, tvSeries" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="attributes">Attributes</label>
                    <input type="text" id="attributes" placeholder="Enter attributes (optional)">
                </div>

                <div class="form-group">
                    <label for="is-original">Is Original Title? *</label>
                    <select id="is-original" required>
                        <option value="1">Yes</option>
                        <option value="0">No</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="cancel-button" onclick="closeInsertModal()">Cancel</button>
                <button onclick="submitInsert()">Submit</button>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="edit-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Record</h2>
            </div>
            <div class="modal-body">
                <input type="hidden" id="edit-titleid">
                
                <div class="form-group">
                    <label>Title ID</label>
                    <input type="text" id="display-titleid" disabled style="background-color: #f5f5f5;">
                    <small style="color: #666;">Title ID cannot be modified</small>
                </div>

                <div class="form-group">
                    <label for="edit-ordering">Ordering *</label>
                    <input type="number" id="edit-ordering" required>
                </div>

                <div class="form-group">
                    <label for="edit-title">Title *</label>
                    <textarea id="edit-title" required></textarea>
                </div>

                <div style="background-color: #fff3cd; padding: 10px; border-radius: 4px; margin-top: 15px;">
                    <small style="color: #856404;">
                        <strong>Note:</strong> Only Title and Ordering can be updated. Other fields are read-only.
                    </small>
                </div>
            </div>
            <div class="modal-footer">
                <button class="cancel-button" onclick="closeEditModal()">Cancel</button>
                <button onclick="submitUpdate()">Update</button>
            </div>
        </div>
    </div>

    <!-- Report Modal -->
    <div id="report-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="report-title">Generated Report</h2>
            </div>
            <div class="modal-body">
                <pre id="report-content" style="background: #f4f4f4; padding: 15px; border-radius: 4px; font-family: monospace; white-space: pre-wrap;">Loading...</pre>
            </div>
            <div class="modal-footer">
                <button onclick="document.getElementById('report-modal').classList.remove('active')">Close</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
    <script src="{{ url_for('static', filename='js/nodeView.js') }}"></script>
</body>
</html>